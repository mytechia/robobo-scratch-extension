<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Robobo Sensors</title>
    <script src="https://mytechia.github.io/robobo-scratch-extension/remote-library/remotelib.js"></script>
</head>
<body>

    <div id="sensors">
        <h1>Sensors</h1>
        <id id="color-sensor">Color: <span id="color-sensor-value"></span></id>
        </br>
        <id id="facepos-sensor">Last face position: <span id="facepos-sensor-value"></span></id>
        </br>
        <id id="facedist-sensor">Last face distance: <span id="facedist-sensor-value"></span></id>
        </br>
        <id id="tap-sensor">Last tap position: <span id="tap-sensor-value"></span></id>
        </br>
        <id id="fling-sensor">Last fling angle: <span id="fling-sensor-value"></span> ยบ</id>
        </br>
        <id id="brightness-sensor">Brightness: <span id="brightness-sensor-value"></span></id>
        </br>
        <id id="accel-sensor">Aceleration: <span id="accel-sensor-value"></span></id>
        </br>
        <id id="orientation-sensor">Orientation: <span id="orientation-sensor-value"></span></id>
        </br>
        <id id="rob-batery-sensor">ROB battery: <span id="rob-batery-value"></span> %</id>
        </br>
        <id id="obo-batery-sensor">OBO battery: <span id="obo-batery-value"></span> %</id>
    </div>

    <script>

        function getAllUrlParams(url) {

            // get query string from url (optional) or window
            var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

            // we'll store the parameters here
            var obj = {};

            // if query string exists
            if (queryString) {

                // stuff after # is not part of query string, so get rid of it
                queryString = queryString.split('#')[0];

                // split our query string into its component parts
                var arr = queryString.split('&');

                for (var i=0; i<arr.length; i++) {
                    // separate the keys and the values
                    var a = arr[i].split('=');

                    // in case params look like: list[]=thing1&list[]=thing2
                    var paramNum = undefined;
                    var paramName = a[0].replace(/\[\d*\]/, function(v) {
                        paramNum = v.slice(1,-1);
                        return '';
                    });

                    // set parameter value (use 'true' if empty)
                    var paramValue = typeof(a[1])==='undefined' ? true : a[1];

                    // (optional) keep case consistent
                    paramName = paramName.toLowerCase();
                    paramValue = paramValue.toLowerCase();

                    // if parameter name already exists
                    if (obj[paramName]) {
                        // convert value to array (if still string)
                        if (typeof obj[paramName] === 'string') {
                            obj[paramName] = [obj[paramName]];
                        }
                        // if no array index number specified...
                        if (typeof paramNum === 'undefined') {
                            // put the value on the end of the array
                            obj[paramName].push(paramValue);
                        }
                        // if array index number specified...
                        else {
                            // put the value at that index number
                            obj[paramName][paramNum] = paramValue;
                        }
                    }
                    // if param name doesn't exist yet, set it
                    else {
                        obj[paramName] = paramValue;
                    }
                }
            }

            return obj;
        };

        var hola = parent.foo;

        rem = new Remote(getAllUrlParams().ip,"");

        rem.connect();
        rem.waitForConnection();
        rem.registerCallback("onNewColor", function() {});
        rem.registerCallback("onIrChanged",function() {});
        rem.registerCallback("onNewFace",function() {});
        rem.registerCallback("onLostFace",function() {});
        rem.registerCallback("onFall",function() {});
        rem.registerCallback("onGap",function() {});
        rem.registerCallback("onLowBatt",function() {});
        rem.registerCallback("onLowOboBatt",function() {});
        rem.registerCallback("onNewTap",function() {});
        rem.registerCallback("onNewClap",function() {});
        rem.registerCallback("onNewFling",function() {});
        rem.registerCallback("onAccelChanged", function() {});
        rem.registerCallback("onObstacle", function() {});
        rem.registerCallback("onError", function() {});
        rem.registerCallback("onPhrase", function() {});
        rem.registerCallback("onConnectionChanges", function() {});
        rem.registerCallback("onNewTap", function() {});


        function updateSensors() {

            var colorSensor = rem.checkMeasuredColor('red') + ' | ' + rem.checkMeasuredColor('green') + ' | ' + rem.checkMeasuredColor('blue');
            document.getElementById("color-sensor-value").innerHTML = colorSensor;

            document.getElementById("brightness-sensor-value").innerHTML = rem.getBrightness();

            var accelSensor = rem.getAcceleration('x') + ' | ' + rem.getAcceleration('y') + ' | ' + rem.getAcceleration('z');
            document.getElementById("accel-sensor-value").innerHTML = accelSensor;

            var orSensor = rem.getOrientation('yaw') + ' | ' + rem.getOrientation('pitch') + ' | ' + rem.getOrientation('roll');
            document.getElementById("orientation-sensor-value").innerHTML = orSensor;

            var faceSensor = rem.getFaceCoord('x') + ' | ' + rem.getFaceCoord('y');
            document.getElementById("facepos-sensor-value").innerHTML = faceSensor;

            document.getElementById("facedist-sensor-value").innerHTML = rem.getFaceDist();

            var tapSensor = rem.getTapCoord('x') + ' | ' + rem.getTapCoord('y');
            document.getElementById("tap-sensor-value").innerHTML = tapSensor;

            document.getElementById("fling-sensor-value").innerHTML = rem.checkFlingAngle();

            document.getElementById("rob-batery-value").innerHTML = rem.checkBatt();

            document.getElementById("obo-batery-value").innerHTML = rem.checkOboBatt();

        }

        setInterval(updateSensors, 250);


    </script>

</body>
</html>